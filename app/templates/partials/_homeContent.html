<!-- FontAwesome para íconos -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<!-- Bootstrap (opcional pero recomendado para responsive) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">


<div class="welcome-wrapper text-center">
  <h1 class="welcome-title">BIENVENIDO</h1>
  <p class="welcome-text">
    ¡Gracias por utilizar el sistema! Aquí puedes gestionar tus pacientes, registrar atenciones y más.
  </p>

  <img
    src="https://images.pexels.com/photos/4421493/pexels-photo-4421493.jpeg"
    alt="Médico trabajando"
    class="doctor-image"
  />

  <div class="patients-list-container">
    <div class="patients-list-title">Lista de Pacientes</div>
    <input type="text" class="search-input" id="searchInput" placeholder="Buscar paciente..." onkeyup="filterPatients()">

    <div id="patient-list">
      {% for p in patients %}
        <div class="patient-card" onclick="verHistorial('{{ p.id }}')">
          <i class="fas fa-user-circle patient-icon"></i>
          <div class="patient-info">
            <p class="patient-name">{{ p.firstName }} {{ p.lastName1 }}</p>
            <p class="patient-id">ID: {{ p.identifierCode }}</p>
          </div>
        </div>
      {% else %}
        <p class="text-muted text-center">No hay pacientes registrados.</p>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Modal Bootstrap -->
<div class="modal fade" id="patientModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content" id="modal-body">
      <!-- Aquí se inyecta el contenido desde Flask -->
    </div>
  </div>
</div>

<script>
  function filterPatients() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const cards = document.querySelectorAll("#patient-list .patient-card");

    cards.forEach(card => {
      const name = card.querySelector(".patient-name").textContent.toLowerCase();
      const id = card.querySelector(".patient-id").textContent.toLowerCase();
      card.style.display = name.includes(input) || id.includes(input) ? "flex" : "none";
    });
  }

  function verHistorial(patientId) {
    fetch(`/historial-paciente/${patientId}`)
      .then(res => res.text())
      .then(html => {
        document.getElementById('modal-body').innerHTML = html;
        const modal = new bootstrap.Modal(document.getElementById('patientModal'));
        modal.show();
      })
      .catch(err => {
        console.error('Error al obtener historial:', err);
        document.getElementById('modal-body').innerHTML = `
          <div class="modal-body text-center text-danger">
            <p>Error al cargar historial.</p>
          </div>`;
        const modal = new bootstrap.Modal(document.getElementById('patientModal'));
        modal.show();
      });
  }
</script>
